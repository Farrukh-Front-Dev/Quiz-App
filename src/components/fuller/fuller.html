<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Send 20 Random Users — Excellent Grade Test</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;margin:20px}
    button{padding:10px 14px;border-radius:8px;border:1px solid #ccc;cursor:pointer}
    pre{background:#f6f8fa;padding:12px;border-radius:6px;overflow:auto}
    .ok{color:green}.err{color:crimson}
  </style>
</head>
<body>
  <h1>20 ta tasodifiy userni API ga yuborish</h1>
  <p>Endpoint (asosiy): <code>https://excellent-grade-test.onrender.com/users</code></p>
  <p>NOTE: agar API CORS bilan bloklansa, pastdagi <strong>Node / curl</strong> variantini ishlating.</p>

  <label>Yuboriladigan son: <input id="count" type="number" value="20" min="1" max="200" /></label>
  <br/><br/>
  <button id="sendBtn">Send users</button>
  <button id="downloadBtn">Download payloads (JSON)</button>
  <h3>Natija</h3>
  <div id="log"></div>
  <h3>Raw request preview (first 1)</h3>
  <pre id="preview"></pre>

<script>
// --- Helper utilities ---
function uuidv4(){ // simple UUID generator
  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){
    var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);
    return v.toString(16);
  });
}
function isoNow(){return new Date().toISOString();}

const NAMES = ["Farrukh","Ali","Sardor","Aziza","Nilufar","Jasur","Umid","Diyor","Madina","Lola","Bek","Jamshid","Zafar","Murod","Nargiza","Dina","Otabek","Shokhrukh","Gulnora","Anvar"]
const SURNAMES = ["Jumayev","Karimov","Ergashev","Rashidov","Saidova","Toshpulatov","Yusupov","Usmonov","Rahmonov","Ismoilov","Nazarov","Abdullaev"]
const PHONES = ['+998901234567','+998909876543','+998933445566','+998971234567','+998774445566']
const IZOHES = [
  "ingliz tili fanidan yaxshi o‘qiydi",
  "matematika bo'yicha qiziqishi bor",
  "kompyuter fanlariga qiziqadi",
  "sport bilan shug'ullanadi",
  "kecha darsda faol ishtirok etdi",
  "yaxshi jamoa o'yinchisi",
  "yaratuvchan va mas'uliyatli"
]

function randPick(arr){return arr[Math.floor(Math.random()*arr.length)];}

function makeUser(){
  const id = uuidv4();
  const now = isoNow();
  return {
    id,
    is_active: true,
    is_deleted: false,
    created_at: now,
    updated_at: now,
    deleted_at: null,
    created_by: null,
    updated_by: null,
    deleted_by: null,
    name: randPick(NAMES),
    surname: randPick(SURNAMES),
    phone: randPick(PHONES).replace(/\d$/, Math.floor(Math.random()*10)),
    izoh: randPick(IZOHES),
    results: []
  };
}

// --- Main logic ---
const sendBtn = document.getElementById('sendBtn');
const log = document.getElementById('log');
const preview = document.getElementById('preview');
const downloadBtn = document.getElementById('downloadBtn');

async function sendUsers(count){
  const endpointBase = 'https://excellent-grade-test.onrender.com/users';
  const payloads = [];
  for(let i=0;i<count;i++){
    payloads.push(makeUser());
  }
  preview.textContent = JSON.stringify(payloads[0], null, 2);

  const results = [];
  log.innerHTML = '';

  // try POST /users for creation; if it fails with CORS/404, we'll show payloads for alternative use
  for(let i=0;i<payloads.length;i++){
    const p = payloads[i];
    try{
      const res = await fetch(endpointBase, {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(p)
      });
      const text = await res.text();
      results.push({ok: res.ok, status: res.status, body: text});
      const node = document.createElement('div');
      node.innerHTML = `#${i+1} -> <span class='${res.ok?"ok":"err"}'>${res.ok?"OK":"ERROR"}</span> ${res.status}`;
      log.appendChild(node);
      // small delay to avoid hammering the server
      await new Promise(r=>setTimeout(r, 200));
    }catch(err){
      const node = document.createElement('div');
      node.innerHTML = `#${i+1} -> <span class='err'>Network/CORS error: ${String(err)}</span>`;
      log.appendChild(node);
      results.push({ok:false, error:String(err)});
      // stop on CORS/Network error to avoid spamming
      break;
    }
  }

  return {payloads, results};
}

sendBtn.addEventListener('click', async ()=>{
  sendBtn.disabled = true; sendBtn.textContent = 'Sending...';
  const count = Number(document.getElementById('count').value) || 20;
  const out = await sendUsers(count);
  sendBtn.disabled = false; sendBtn.textContent = 'Send users';
  // if first result was CORS/Network error, show curl/node guidance below
  const first = out.results[0] || {};
  if(first.error || first.status===0){
    const tip = document.createElement('div');
    tip.innerHTML = `<p class="err">BROWSER da CORS yoki network xatosi yuz berdi. Iltimos, quyidagi <strong>Node</strong> yoki <strong>curl</strong> usullaridan birini ishlating — ularni terminalda ishlatishingiz mumkin.</p>`;
    log.appendChild(tip);
  }
});

// Download payloads as JSON file
downloadBtn.addEventListener('click', ()=>{
  const count = Number(document.getElementById('count').value) || 20;
  const arr = Array.from({length:count}, ()=>makeUser());
  const blob = new Blob([JSON.stringify(arr, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'users_payloads.json';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

</script>

<hr/>
<h3>CLI (Node / curl) misollar — agar CORS bo'lsa ishlatish uchun</h3>
<pre>
# 1) Node.js bilan (save as send.js va node send.js):

/*
const fetch = (...args) => import('node-fetch').then(({default: fetch}) => fetch(...args));
(async ()=>{
  const payloads = [ /* paste JSON array from downloaded users_payloads.json here */ /* ];
  for(const p of payloads){
    const res = await fetch('https://excellent-grade-test.onrender.com/users', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(p)});
    console.log(res.status, await res.text());
  }
})();
*/

# 2) curl misoli (bitta user yuborish):
# curl -X POST https://excellent-grade-test.onrender.com/users -H "Content-Type: application/json" -d @user.json
# where user.json contains one JSON object
</pre>

<p><em>Oxirgi eslatma:</em> men faylga 20 ta user yaratish va yuborish uchun brauzer-faylni tayyorladim. Agar serverda maxsus authentication kerak bo'lsa yoki endpoint boshqacha bo'lsa (masalan /users/:id PUT), faylni moslashtirish mumkin.</p>
</body>
</html>